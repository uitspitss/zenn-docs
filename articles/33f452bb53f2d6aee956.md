---
title: "Next.jsã¨TypeScriptã§Firebaseã®Google authenticationã‚’å®Ÿè£…ã™ã‚‹"
emoji: "ğŸ”¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nextjs", "firebase", "typescript", "react"]
published: true
---

# å‚™å¿˜éŒ²ã¨ã—ã¦ã¾ã¨ã‚ã¾ã™ã€‚

# Nextjs ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
yarn create next-app my-app --example with-typescript
```

## ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç§»å‹•

```bash
mkdir src
mv  pages src
mv  components src
mkdir src/lib
```

ã‚ã¨`tsconfig.json`ã«

```json:tsconfig.json
"baseUrl": ".",
"paths": {
  "~/*": ["./src/../*"]
},
```

ã‚’è¿½åŠ ã—ã¦ãŠã

# Firebase ã§ æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ã‚’ã¤ãã‚‹

https://console.firebase.google.com/
ã§æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ã¦

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š > å…¨èˆ¬ ã‹ã‚‰ API key ãªã©ã‚’.env.local ã«ä¸‹ã®ã‚ˆã†ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚
â€»`************`ã®ã¨ã“ã‚ã¯ãã‚Œãã‚Œå¯¾å¿œã™ã‚‹å€¤ã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚

```js:.env.local
NEXT_PUBLIC_FIREBASE_API_KEY=************
NEXT_PUBLIC_FIREBASE_AUTH_DOMEIN=************
NEXT_PUBLIC_FIREBASE_DETABASE_URL=************
NEXT_PUBLIC_FIREBASE_PROJECT_ID=************
NEXT_PUBLIC_FIREBASE_STORAGE_BAKET=************
NEXT_PUBLIC_FIREBASE_MESSAGE_SENDER_ID=************
NEXT_PUBLIC_FIREBASE_APP_ID=************
NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID=************
```

ãã‚ŒãŒã§ããŸã‚‰

```bash
yarn add firebase
```

ã§ firebase é–¢é€£ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ 

# Next.js ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ 

ã¤ãã«ã€ä»¥ä¸‹ã® Nextjs ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚

```ts:src/lib/firebase.ts
import firebase from "firebase/app";
import "firebase/auth"; // If you need it

export const config = {
  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,
  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMEIN,
  databaseURL: process.env.NEXT_PUBLIC_FIREBASE_DATABASE_URL,
  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,
  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,
  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,
};

!firebase.apps.length ? firebase.initializeApp(config) : firebase.app();

export const auth = firebase.auth();
export const Firebase = firebase;

export const Login = () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  firebase
    .auth()
    .signInWithPopup(provider)
    .then(function (result: any) {
      return result;
    })
    .catch(function (error) {
      console.log(error);
      const errorCode = error.code;
      console.log(errorCode);
      const errorMessage = error.message;
      console.log(errorMessage);
    });
};

// ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®æ¤œçŸ¥
export const listenAuthState = (dispatch: any) => {
  return firebase.auth().onAuthStateChanged(function (user) {
    if (user) {
      // User is signed in.
      dispatch({
        type: "login",
        payload: {
          user,
        },
      });
    } else {
      // User is signed out.
      // ...
      dispatch({
        type: "logout",
      });
    }
  });
};

export const firebaseUser = () => {
  return firebase.auth().currentUser;
};

// Logout
export const Logout = () => {
  auth.signOut().then(() => {
    window.location.reload();
  });
};

```

```ts:src/lib/AuthContext.ts
import React from "react"
const AuthContext = React.createContext({})
export default AuthContext
```

```ts:src/lib/authReducer.ts
const initialState = {}

const reducer = (state: any, action: any) => {
  switch (action.type) {
    case "login":
      return action.payload.user
    case "logout":
      return initialState
    default:
      return state
  }
}

export default {
  initialState,
  reducer,
}
```

æœ€å¾Œã«`src/pages/index.tsx`ã‚’ä¿®æ­£ã™ã‚Œã°é–‘é™ã§ã™

```ts:src/pages/index.tsx
// import Link from "next/link";
import Layout from "../components/Layout";
import { Login, Logout, auth } from "~/src/lib/firebase";

const IndexPage = () => (
  <Layout title="Home | Next.js + TypeScript Example">
    <h1>Hello Next.js ğŸ‘‹</h1>
    <div>
      <button onClick={() => Login()}>ãƒ­ã‚°ã‚¤ãƒ³</button>
      <button onClick={() => Logout()}>ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>
    <div>
      <pre>
        {auth.currentUser
          ? auth.currentUser.displayName + "ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã™"
          : "ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“"}
      </pre>
    </div>
  </Layout>
);

export default IndexPage;
```
# å®Œæˆ
ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã¨ãã¯ã“ã®ã‚ˆã†ã«
![](https://storage.googleapis.com/zenn-user-upload/ny40lk4uvyrz52c5edsy09db63g5)

æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã¯ã“ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆæ€ã„ã¾ã™
![](https://storage.googleapis.com/zenn-user-upload/soogzrtt8vgrtj8dy7dx0j0fxm65)

